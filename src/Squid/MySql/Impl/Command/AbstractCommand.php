<?php
namespace Squid\MySql\Impl\Command;


use Squid\MySql\IMySqlCommand;
use Squid\MySql\Connection\IMySqlConnection;
use Squid\Exceptions\SquidException;


abstract class AbstractCommand implements IMySqlCommand
{
	/** @var IMySqlConnection Connection to use for execution. */
	private $conn	= null;
	
	
	/**
	 * Get the connection.
	 * @todo Fix return type
	 * @return mixed|null Connection.
	 */
	protected function getConn() {
		return $this->conn;
	}
	
	
	/**
	 * Set the connection to use.
	 * @param \Squid\MySql\Connection\IMySqlConnection $conn
	 */
	public function setConnection(IMySqlConnection $conn) {
		$this->conn = $conn;
	}

	/**
	 * Execute the generated query.
	 * @return mixed|null Result generated by the query, or null on fail.
	 * @throws SquidException
	 */
	public function execute() {
		if (is_null($this->conn)) {
			throw new SquidException("Can't execute query, implicitly created without connection!");
		}
		
		$cmd = $this->assemble();
		$bind = $this->bind();
		
		return $this->conn->execute($cmd, $bind);
	}
}